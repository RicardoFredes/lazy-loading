<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Test intersection</title>
	<style>
		.box {
			max-width: 768px;
			margin: auto;
		}
		.spacer {
			height: 500px;
			border-top: 1px solid #CCC;
			border-bottom: 1px solid #CCC;
			margin: 30px 0;
		}
		img {
			max-width: 100%;
			height: auto;
		}
		.LazyLoading {
			transition: all ease-out 1s;
			transition-delay: .25s;
		}
		.Loading {
			transform: translateY(50px);
			opacity: 0;
		}
	</style>
</head>
<body>
	<div class="box">
		<h1>Intersection test</h1>
		<p>
			This begins by setting up an options object containing the settings for the observer. We want to watch for changes in visibility of the target element relative to the document's viewport, so root is null. We need no margin, so the margin offset, rootMargin, is specified as "0px". This causes the observer to watch for changes in the intersection between the target element's bounds and those of the viewport, without any added (or subtracted) space.
		</p>
		<div class="spacer"></div>
		<p>
			This begins by setting up an options object containing the settings for the observer. We want to watch for changes in visibility of the target element relative to the document's viewport, so root is null. We need no margin, so the margin offset, rootMargin, is specified as "0px". This causes the observer to watch for changes in the intersection between the target element's bounds and those of the viewport, without any added (or subtracted) space.
		</p>
		<div class="spacer"></div>
		<img height="620" width="1168" data-src="http://www.negretti.com.br/wp-content/uploads/2017/04/seo-google-1168x620.jpg" />
		<div class="spacer"></div>
		<img height="620" width="1168" data-src="http://www.negretti.com.br/wp-content/uploads/2017/04/seo-google-1168x620.jpg" />
		<div class="spacer"></div>
	</div>
	<script>
		(function lazyLoading() {
			const images = document.querySelectorAll('img[data-src]');
			window.addEventListener("load", observerImages);
			function observerImages() {
				images.forEach(function(image){
					image.classList.add('LazyLoading', 'Loading');
					image.setAttribute('src', image.getAttribute('data-src'));
					image.setAttribute('data-status', 'loading');
					image.onload = function() {
						image.setAttribute('data-status', 'loaded');
					};
					const observer = new IntersectionObserver(handleIntersect);
					observer.observe(image);
				});
			}
			function handleIntersect(image) {
				if (!image[0].isIntersecting) { return; }
				const element = image[0].target;
				if (element.getAttribute('data-status') !== 'loaded') { return; }
				element.classList.remove('Loading');
			}
		})();
	</script>
</body>
</html>